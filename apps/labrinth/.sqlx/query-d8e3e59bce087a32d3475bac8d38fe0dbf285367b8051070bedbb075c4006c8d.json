{
  "db_name": "PostgreSQL",
  "query": "\n        SELECT\n            m.id AS \"project_id: DBProjectId\",\n            t.id AS \"project_thread_id: DBThreadId\",\n            to_jsonb(dr)\n            || jsonb_build_object(\n                'file_id', f.id,\n                'version_id', v.id,\n                'project_id', v.mod_id,\n                'file_name', f.filename,\n                'file_size', f.size,\n                'flag_reason', 'delphi',\n                'issues', json_array(\n                    SELECT\n                        to_jsonb(dri)\n                        || jsonb_build_object(\n                            'details', json_array(\n                                SELECT jsonb_build_object(\n                                    'id', drid.id,\n                                    'issue_id', drid.issue_id,\n                                    'key', drid.key,\n                                    'file_path', drid.file_path,\n                                    -- ignore `decompiled_source`\n                                    'data', drid.data,\n                                    'severity', drid.severity\n                                )\n                                FROM delphi_report_issue_details drid\n                                WHERE drid.issue_id = dri.id\n                            )\n                        )\n                    FROM delphi_report_issues dri\n                    WHERE dri.report_id = dr.id\n                )\n            ) AS \"report!: sqlx::types::Json<FileReport>\"\n        FROM delphi_reports dr\n        INNER JOIN files f ON f.id = dr.file_id\n        INNER JOIN versions v ON v.id = f.version_id\n        INNER JOIN mods m ON m.id = v.mod_id\n        INNER JOIN threads t ON t.mod_id = m.id\n        INNER JOIN delphi_report_issues dri ON dri.report_id = dr.id\n        LEFT JOIN delphi_report_issue_details drid ON drid.issue_id = dri.id\n\n        -- filtering\n        LEFT JOIN mods_categories mc ON mc.joining_mod_id = m.id\n        LEFT JOIN categories c ON c.id = mc.joining_category_id\n        WHERE\n            -- project type\n            (cardinality($1::int[]) = 0 OR c.project_type = ANY($1::int[]))\n\n        -- sorting\n        ORDER BY\n            CASE WHEN $2 = 'created_asc' THEN created ELSE TO_TIMESTAMP(0) END ASC,\n            CASE WHEN $2 = 'created_desc' THEN created ELSE TO_TIMESTAMP(0) END DESC,\n            CASE WHEN $2 = 'severity_asc' THEN dr.severity ELSE 'low'::delphi_severity END ASC,\n            CASE WHEN $2 = 'severity_desc' THEN dr.severity ELSE 'low'::delphi_severity END DESC\n\n        -- pagination\n        LIMIT $3\n        OFFSET $4\n        ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "project_id: DBProjectId",
        "type_info": "Int8"
      },
      {
        "ordinal": 1,
        "name": "project_thread_id: DBThreadId",
        "type_info": "Int8"
      },
      {
        "ordinal": 2,
        "name": "report!: sqlx::types::Json<FileReport>",
        "type_info": "Jsonb"
      }
    ],
    "parameters": {
      "Left": [
        "Int4Array",
        "Text",
        "Int8",
        "Int8"
      ]
    },
    "nullable": [
      false,
      false,
      null
    ]
  },
  "hash": "d8e3e59bce087a32d3475bac8d38fe0dbf285367b8051070bedbb075c4006c8d"
}
